<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Delivery Visits & Material Lookup</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  padding:20px;
}

.container {
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}

select, input, button {
  padding:8px;
  width:100%;
  margin-top:8px;
}

button {
  background:#007bff;
  color:white;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

.result {
  margin-top:15px;
  background:#f1f1f1;
  padding:15px;
  border-radius:8px;
}

.grid {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-top:10px;
}

.box {
  background:#e9f2ff;
  padding:10px;
  text-align:center;
  border-radius:6px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container">
<h2>Delivery Visits</h2>

<label>Store</label>
<select id="storeSelect">
  <option value="">-- Select Store --</option>
</select>

<div id="visitResult" class="result" style="display:none;"></div>

<hr>

<h2>Material Search</h2>
<label>Material Number (6 digits)</label>
<input type="text" id="materialInput" placeholder="Ex: 123456">

<button onclick="searchMaterial()">Search</button>

<div id="materialResult" class="result" style="display:none;"></div>
</div>

<script>
// ================= LINKS =================
const DELIVERY_URL =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXlvP1WVT_NHTcqNPp-bv0_Renbo-PXFsLPOssgOi1TSjWjTuqRyUAH5boHUwoZsRUo5cvwT2I_1K-/pub?gid=0&single=true&output=csv';

const AVAIL_URL =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vQDJxjTG91GO_Lh5008Lrtl4ZcQnxOXY2O1P0BNVVWEDdRsJrIDnMPIWHAsoGJ7D1_R7og9It0woY_W/pub?gid=0&single=true&output=csv';

// ================= DATA =================
let delivery = [];
let availability = [];

// ================= LOAD DELIVERY =================
fetch(DELIVERY_URL)
.then(r => r.text())
.then(csv => {
  const rows = csv.trim().split('\n').map(r => r.split(','));

  rows.slice(1).forEach(r => {
    delivery.push({
      store: r[1],
      first: r[2],
      second: r[3],
      third: r[4],
      wh: r[5].toLowerCase()
    });
  });

  const sel = document.getElementById('storeSelect');
  delivery.forEach(d => {
    const o = document.createElement('option');
    o.value = d.store;
    o.textContent = d.store;
    sel.appendChild(o);
  });
});

// ================= LOAD AVAILABILITY =================
fetch(AVAIL_URL)
.then(r => r.text())
.then(csv => {
  const rows = csv.trim().split('\n').map(r => r.split(','));
  rows.slice(1).forEach(r => {
    availability.push({
      material: r[0],
      w1: r[1],
      w2: r[2],
      w3: r[3],
      w4: r[4]
    });
  });
});

// ================= STORE CHANGE =================
document.getElementById('storeSelect').addEventListener('change', function () {
  const s = delivery.find(d => d.store === this.value);
  if (!s) return;

  document.getElementById('visitResult').innerHTML = `
    <div class="grid">
      <div class="box">${s.first || '-'}</div>
      <div class="box">${s.second || '-'}</div>
      <div class="box">${s.third || '-'}</div>
      <div class="box">WH: ${s.wh.toUpperCase()}</div>
    </div>
  `;
  document.getElementById('visitResult').style.display = 'block';
});

// ================= MATERIAL SEARCH =================
function searchMaterial() {
  const mat = document.getElementById('materialInput').value.trim();
  const store = document.getElementById('storeSelect').value;

  if (!/^\d{6}$/.test(mat)) {
    alert('Material Number must be 6 digits');
    return;
  }

  if (!store) {
    alert('Select Store first');
    return;
  }

  const d = delivery.find(x => x.store === store);
  const m = availability.find(x => x.material === mat);

  if (!m) {
    document.getElementById('materialResult').innerText = 'Material not found';
    document.getElementById('materialResult').style.display = 'block';
    return;
  }

  const value = m[d.wh];

  document.getElementById('materialResult').innerHTML = `
    <b>Store:</b> ${store}<br>
    <b>WH:</b> ${d.wh.toUpperCase()}<br>
    <b>Material:</b> ${mat}<br>
    <b>Value:</b> ${value}
  `;
  document.getElementById('materialResult').style.display = 'block';
}
</script>

</body>
</html>
