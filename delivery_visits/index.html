<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Delivery Visits & Material Lookup</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  padding:20px;
}

.container {
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,.1);
}

h1 {
  text-align:center;
  margin-bottom:20px;
}

.section {
  margin-bottom:30px;
}

label {
  font-weight:bold;
}

select, input, button {
  padding:8px;
  margin-top:8px;
  width:100%;
}

button {
  background:#007bff;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

button:hover {
  background:#0056b3;
}

.result-box {
  margin-top:15px;
  padding:15px;
  background:#f1f1f1;
  border-radius:8px;
}

.visit-grid {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-top:10px;
}

.visit-card {
  background:#e9f2ff;
  padding:10px;
  border-radius:6px;
  text-align:center;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container">
<h1>Delivery Visits & Material Lookup</h1>

<!-- ================= VISITS ================= -->
<div class="section">
<label>Select Store</label>
<select id="storeSelect">
  <option value="">-- Select Store --</option>
</select>

<div id="visitResult" class="result-box" style="display:none;"></div>
</div>

<!-- ================= MATERIAL ================= -->
<div class="section">
<label>Material Number (6 digits)</label>
<input type="text" id="materialInput" placeholder="Enter Material Number">

<button onclick="searchMaterial()">Search Material</button>

<div id="materialResult" class="result-box" style="display:none;"></div>
</div>
</div>

<script>
// ================= LINKS =================
const deliveryCSV =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXlvP1WVT_NHTcqNPp-bv0_Renbo-PXFsLPOssgOi1TSjWjTuqRyUAH5boHUwoZsRUo5cvwT2I_1K-/pub?gid=0&single=true&output=csv';

const availabilityCSV =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vQDJxjTG91GO_Lh5008Lrtl4ZcQnxOXY2O1P0BNVVWEDdRsJrIDnMPIWHAsoGJ7D1_R7og9It0woY_W/pub?gid=0&single=true&output=csv';

// ================= DATA =================
let deliveryData = [];
let availabilityData = [];

// ================= LOAD DELIVERY =================
fetch(deliveryCSV)
.then(res => res.text())
.then(text => {
  const rows = text.trim().split('\n').map(r => r.split(','));
  rows.slice(1).forEach(r => {
    deliveryData.push({
      city: r[0],
      store: r[1],
      first: r[2],
      second: r[3],
      third: r[4],
      wh: r[5] ? r[5].toLowerCase() : 'w1'
    });
  });

  const select = document.getElementById('storeSelect');
  deliveryData.forEach(d => {
    const opt = document.createElement('option');
    opt.value = d.store;
    opt.textContent = d.store;
    select.appendChild(opt);
  });
});

// ================= LOAD AVAILABILITY =================
fetch(availabilityCSV)
.then(res => res.text())
.then(text => {
  const rows = text.trim().split('\n').map(r => r.split(','));
  rows.slice(1).forEach(r => {
    availabilityData.push({
      material: r[0],
      w1: r[1],
      w2: r[2],
      w3: r[3]
    });
  });
});

// ================= STORE CHANGE =================
document.getElementById('storeSelect').addEventListener('change', function() {
  const store = this.value;
  const data = deliveryData.find(d => d.store === store);

  if (!data) return;

  let html = `<b>Visit Dates for ${store}</b><div class="visit-grid">`;

  if (data.first) html += `<div class="visit-card">${data.first}</div>`;
  if (data.second) html += `<div class="visit-card">${data.second}</div>`;
  if (data.third) html += `<div class="visit-card">${data.third}</div>`;

  html += '</div>';

  const box = document.getElementById('visitResult');
  box.innerHTML = html;
  box.style.display = 'block';
});

// ================= MATERIAL SEARCH =================
function searchMaterial() {
  const mat = document.getElementById('materialInput').value.trim();
  const store = document.getElementById('storeSelect').value;

  if (!/^\d{6}$/.test(mat)) {
    alert('Material Number must be 6 digits');
    return;
  }

  if (!store) {
    alert('Please select Store first');
    return;
  }

  const del = deliveryData.find(d => d.store === store);
  if (!del) return;

  const matRow = availabilityData.find(a => a.material === mat);
  if (!matRow) {
    document.getElementById('materialResult').innerHTML = 'Material not found';
    document.getElementById('materialResult').style.display = 'block';
    return;
  }

  const value = matRow[del.wh];

  document.getElementById('materialResult').innerHTML =
  `<b>Material:</b> ${mat}<br>
   <b>Store:</b> ${store}<br>
   <b>WH:</b> ${del.wh.toUpperCase()}<br>
   <b>Availability:</b> ${value}`;

  document.getElementById('materialResult').style.display = 'block';
}
</script>

</body>
</html>
