<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Delivery & Material Lookup</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  padding:20px;
}

.container {
  max-width:1000px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
}

select, input, button {
  padding:8px;
  width:100%;
  margin-top:8px;
}

button {
  background:#007bff;
  color:white;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

.result {
  margin-top:15px;
  background:#f1f1f1;
  padding:15px;
  border-radius:8px;
}

.grid {
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:8px;
}

.box {
  background:#e9f2ff;
  padding:10px;
  text-align:center;
  border-radius:6px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container">
<h2>Store Visits</h2>

<label>STORE</label>
<select id="storeSelect">
  <option value="">-- Select STORE --</option>
</select>

<div id="visitResult" class="result" style="display:none;"></div>

<hr>

<h2>Material Search</h2>
<label>Material OR Material Description</label>
<input type="text" id="materialInput" placeholder="Enter Material or Description">

<button onclick="searchMaterial()">Search</button>

<div id="materialResult" class="result" style="display:none;"></div>
</div>

<script>
// ================= LINKS =================
const DELIVERY_URL =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vSXlvP1WVT_NHTcqNPp-bv0_Renbo-PXFsLPOssgOi1TSjWjTuqRyUAH5boHUwoZsRUo5cvwT2I_1K-/pub?gid=0&single=true&output=csv';

const AVAIL_URL =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vQDJxjTG91GO_Lh5008Lrtl4ZcQnxOXY2O1P0BNVVWEDdRsJrIDnMPIWHAsoGJ7D1_R7og9It0woY_W/pub?gid=0&single=true&output=csv';

// ================= DATA =================
let delivery = [];
let availability = [];

// ================= LOAD DELIVERY =================
fetch(DELIVERY_URL)
.then(r => r.text())
.then(csv => {
  const rows = csv.trim().split('\n').map(r => r.split(','));

  rows.slice(1).forEach(r => {
    delivery.push({
      city: r[0],
      wh: r[1],
      store: r[2],
      first: r[3],
      second: r[4],
      third: r[5]
    });
  });

  const sel = document.getElementById('storeSelect');
  delivery.forEach(d => {
    const o = document.createElement('option');
    o.value = d.store;
    o.textContent = d.store;
    sel.appendChild(o);
  });
});

// ================= LOAD AVAILABILITY =================
fetch(AVAIL_URL)
.then(r => r.text())
.then(csv => {
  const rows = csv.trim().split('\n').map(r => r.split(','));

  rows.slice(1).forEach(r => {
    availability.push({
      material: r[0],
      desc: r[1],
      wh1: r[2],
      wh2: r[3]
    });
  });
});

// ================= STORE CHANGE =================
document.getElementById('storeSelect').addEventListener('change', function () {
  const d = delivery.find(x => x.store === this.value);
  if (!d) return;

  document.getElementById('visitResult').innerHTML = `
    <div class="grid">
      <div class="box">${d.city}</div>
      <div class="box">${d.wh}</div>
      <div class="box">${d.store}</div>
      <div class="box">${d.first || '-'}</div>
      <div class="box">${d.second || '-'}</div>
      <div class="box">${d.third || '-'}</div>
    </div>
  `;
  document.getElementById('visitResult').style.display = 'block';
});

// ================= MATERIAL SEARCH =================
function searchMaterial() {
  const q = document.getElementById('materialInput').value.trim().toLowerCase();
  const store = document.getElementById('storeSelect').value;

  if (!q) {
    alert('Enter Material or Description');
    return;
  }

  if (!store) {
    alert('Select STORE first');
    return;
  }

  const d = delivery.find(x => x.store === store);
  const m = availability.find(x =>
    x.material.toLowerCase().includes(q) ||
    x.desc.toLowerCase().includes(q)
  );

  if (!m) {
    document.getElementById('materialResult').innerText = 'Material not found';
    document.getElementById('materialResult').style.display = 'block';
    return;
  }

  const value = d.wh === 'W1' ? m.wh1 : m.wh2;

  document.getElementById('materialResult').innerHTML = `
    <b>Material:</b> ${m.material}<br>
    <b>Description:</b> ${m.desc}<br>
    <b>WH:</b> ${d.wh}<br>
    <b>Value:</b> ${value}
  `;
  document.getElementById('materialResult').style.display = 'block';
}
</script>

</body>
</html>
